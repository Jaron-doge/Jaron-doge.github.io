---
title: 第2章 操作系统结构
date: 2020-09-26 20:30:15
tags: 
categories: 操作系统
---
## 第2章 操作系统结构

### 系统组件

#### 进程管理

<!-- more -->

- 创建/销毁流程
- 进程状态转移

#### 主存管理

- CPU和I / O设备共享的快速访问数据的存储库
- 易失性存储设备
- 跟踪内存使用情况
- 确定何时有可用的内存空间来加载哪些进程
- 分配和释放内存空间

#### I/O 系统管理

由缓冲，缓存和假脱机、通用设备驱动程序接口、特定硬件设备的驱动程序组成

#### 文件管理系统

- 将文件映射到辅助存储
- 稳定（非易失性）存储介质上的文件备份（备份）

#### 辅存管理

- 自由空间管理
- 存储分配
- 磁盘调度

#### 保护系统

- 用于控制程序，进程或用户对系统和用户资源的访问的机制

### 操作系统服务

- 接口：UI、CLI、GUI
- 通信–进程可以在同一台计算机上或通过网络在计算机之间交换信息
- 错误检测–操作系统需要不断意识到可能的错误
- 资源分配-当多个用户或多个作业同时运行时，必须为每个用户分配资源
- 记帐-跟踪哪些用户使用多少计算机资源
- 保护和安全-存储在多用户或网络计算机系统中的信息的所有者可能希望控制该信息的使用，并发进程不应相互干扰

### 系统调用

- 操作系统提供的程序接口服务，通常由API访问，而不是直接使用系统调用
- 系统调用接口调用OS内核中的预期系统调用，并返回系统调用的状态和所有返回值

![image-20200924102332537.png](https://i.loli.net/2020/09/24/jFiYo6rxSVZsE4P.png)

#### 系统调用参数传递

三种用于将参数传递给的方法

- 在寄存器中传递参数
- 存储在内存的块或表中的参数，块或表的地址通过寄存器来传递
- 程序将参数放置或推入堆栈，然后操作系统将其弹出堆栈
  - 块和堆栈方法不限制要传递的参数的数量或长度

#### 系统调用的种类

- 进程控制
- 文件管理
- 设备管理
- 信息维护
- 通信
- 保护

### 操作系统设计与实现

- 设计操作系统的第一个问题是定义目标（target）和规格（spec）requirement（需求）
- 机制决定如何来做
- 策略决定做什么

### 操作系统结构

#### 简单结构

- 没有清晰的体系结构
- 操作系统功能模块和用户应用程序混杂在一起，在同一个地址空间上运行，模块之间可以相互任意调用

#### 单一内核结构(Monolithic structure)

- 用户应用只能通过中断/异常/系统调用的方式使用操作系统提供的服务
- 用户应用程序之间通过各种IPC(Inter-Process Communication)进行通信

缺点：难以实现和维护

#### 模块化设计(Modular kernel)

- 模块之间定义了很好的以函数调用的形式提供的结构
- 在一定程度上提高了操作系统的可维护性

![image-20200924111537520.png](https://i.loli.net/2020/09/24/pLN6nMZwfTE4Vzr.png)

#### 层次结构(Layered approach)

- 为减少OS各模块之间紧密依赖和相互调用的关系，特别是消除循环调用现象，实现有序调用
- 每个层只能使用较低层提供的操作，并向较高层提供某些操作
- 每个层都从较高层隐藏某些数据结构，操作和硬件的存在

优点：构造和调试简单
缺点：适当定义各层、效率较低

#### 微内核结构(Microkernel Structure)

- 较小的内核
- 提供最少的过程和内存管理

优点：可扩展性、可移植性、安全性和可靠性

缺点：因系统功能开销增加导致的性能下降

#### 混合内核(Hybrid structure)

- 扩大微内核并把一些关键的服务程序和驱动程序重新加入到内核中
- 其中一层由微内核组成的分层技术

![image-20200924120019746.png](https://i.loli.net/2020/09/24/69icoJ4yFnbRVO2.png)

### 虚拟机

- 虚拟机采用层次结构得出其逻辑结论。
  - 它将硬件和OS内核视为全部硬件
  - 虚拟机提供的接口与基础裸机相同

- 操作系统产生了多个进程的错觉，每个进程都在具有自己（虚拟）内存的处理器上执行

- 共享物理计算机的资源以创建虚拟机

- 虚拟机管理器将单个计算机接口转换为多个虚拟机，每个虚拟机是原始计算机系统的有效副本，并执行所有处理器指令

![image-20200924120623789.png](https://i.loli.net/2020/09/24/lj3XnAK2VoO8Y6C.png)

### 概念

1.  并发

   并行 vs. 并发: 

   - 并行是指两或多个事件在同一时刻发生

   - 并发是两或多个事件在同一时间间隔内发生

2.  Program vs. Process(进程)

   Program：静态实体
   Process：  动态实体

   - A program in execution.
   - 是系统中能独立运行并作为资源分配的基本单位。
   - 引入线程后，独立运行的单位变为线程。

3.  共享

   - 可供内存中多个并发执行的进程共同使用的系统中资源
   - 互斥共享VS. 同时访问
     - 互斥共享：一段时间只允许一个进程访问该资源
     - 同时访问：微观上仍是互斥的
     - 临界资源：在一段时间内只允许一个进程访问的资源

4. 虚拟

   - 虚拟：通过某种技术把一个物理实体变为若干个逻辑上的对应物。
   - 若n是某一物理设备所对应的虚拟的逻辑设备数，则虚拟设备的速度必然是物理设备速度的1/n。

### 作业

**2.1** What is the purpose of system calls?

​		系统调用是操作系统提供的程序接口服务。系统调用是从user mode进入kernel mode的唯一方法。使用系统调用时,操作系统为正在运行的应用程序提供资源或操作



**2.5** What is the purpose of the command interpreter? Why is it usually
separate from the kernel?

​        获取并执行用户指定的下一条命令。命令解释程序会执行相应的系统调用，因此如果不和kernel分离，会有可能改变kernel部分，这是不安全的。		



**2.8** What is the main advantage of the layered approach to system design?
What are the disadvantages of the layered approach?

​		优点是构造和调试简单，缺点是难以适当定义各层，以及逐层调用效率较低。



**2.12** The services and functions provided by an operating system can be
divided into two main categories. Briefly describe the two categories,
and discuss how they differ.

第一组服务用于提供用户功能，提供以下功能：

- 用户界面	

- 程序执行

- I/O操作
- 文件系统操作
- 通信
- 错误检测

第二组操作系统服务为了确保系统本身运行高效，提供以下功能：

- 资源分配
- 记账
- 保护与安全



**2.13** Describe three general methods for passing parameters to the operating
system.

- 在寄存器中传递参数
- 存储在内存的块或表中的参数，块或表的地址通过寄存器来传递
- 程序将参数压入堆栈，并通过操作系统弹出



**2.16** What are the advantages and disadvantages of using the same systemcall
interface for manipulating both files and devices?

优点：减少接口数量，文件和设备能用一个接口调用，使操作系统更简洁。

缺点：文件和设备的相应操作不能完全对应，如果要将这些操作强行合并，那么其中之一可能要更改操作逻辑，使其与另一个操作类似。为用户调用接口时对接口实施操作的理解带来麻烦，得不偿失。



**2.17** Would it be possible for the user to develop a new command interpreter
using the system-call interface provided by the operating system?

​		可以，任何用户都可以创建一个新的命令解释程序。



**2.19** Why is the separation of mechanism and policy desirable?

​		机制与策略的分离可以使系统更灵活，更容易修改。系统设计者可以创建不变的机制和根据具体需求改变的策略。



**2.21** What is the main advantage of the microkernel approach to system
design? How do user programs and system services interact in a
microkernel architecture? What are the disadvantages of using the
microkernel approach?

​		优点：可扩展性、可移植性、安全性、可靠性。微内核为用户端程序和运行在用户空间中的各种服务提供通信。通信使通过消息传递来提供的，客户程序和系统服务通过内核的消息传递来间接通信。缺点：增加了系统功能开销，导致微内核性能的下降。

​		

**2.22** What are the advantages of using loadable kernel modules?

​		不需要将新功能的实现添加到内核中，内核提供核心服务，其他服务在内核运行时动态实现，更加灵活。

