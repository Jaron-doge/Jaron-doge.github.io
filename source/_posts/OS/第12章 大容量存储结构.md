---
title: 第12章 大容量存储结构
date: 2020-12-12 13:30:15
tags: 
categories: 操作系统
---
## 大容量存储结构

### 12.1 大容量存储结构概述

<!-- more -->

### 12.1.1 磁盘

**传输速率(transfer rate)**

是在驱动器和计算机之间的数据流的速率

**定位时间(positioning time)**：**寻道时间(seek time)**+**旋转延迟(rotational latency)**

**寻道时间**：移动磁臂到所要柱面的所需时间

**旋转延迟**：旋转磁臂到所要扇区的所需时间**(旋转延迟为一圈时间/2)**

- 磁盘是可移动的
- 磁盘驱动器通过I/O总线连到计算机

盘片、转轴、柱面、磁道、扇区、磁臂、读写磁头、机械臂杆

![24.png](https://i.loli.net/2021/06/17/PhGp27YuCS1WiqI.png)

计算机中的主机控制器使用总线与每个磁盘控制器通信

### 12.2 磁盘结构

现代磁盘驱动器可以看作**逻辑块(logical block)**的一维数组，逻辑块是最小的传输单元

- 一维**逻辑块**数组依次映射到磁盘扇区
  - 扇区0是最外面柱面的第一个磁道的第一个扇区
  - 先按磁道内扇区顺序，再按柱面内磁道顺序，再按从外到内的柱面顺序

- 实际上，由于两个原因，映射较为困难
  - 缺陷扇区(defective sectors)
  - 磁道的扇区数不是常量

### 12.4 磁盘调度

**磁盘带宽(disk bandwidth)**

是传输字节的总数，除以从服务请求开始到最后传递结束时的总时间

#### 12.4.1 FCFS调度

![25.png](https://i.loli.net/2021/06/17/AnuvQzN8adGyFUM.png)

#### 12.4.2 SSTF(shortest-seek-time-first)调度

SSTF算法选择处理距离当前磁头位置的最短寻道时间的请求

它会导致一些请求的饥饿

![26.png](https://i.loli.net/2021/06/17/E7IxziqfbUl8Syt.png)

#### 12.4.3 SCAN调度/电梯算法

磁臂从磁盘的一端开始，向另一端移动；当到达磁盘的另一端时，移动方向反转

![27.png](https://i.loli.net/2021/06/17/7WLxy2HoKlBNAd9.png)

#### 12.4.4 C-SCAN调度

磁臂从磁盘一端开始向另一端移动；当磁头到达另一端时，立即返回到磁盘的开头

![28.png](https://i.loli.net/2021/06/17/nwKu43HqEms8NyR.png)

#### 12.4.5 C-LOOK调度

磁臂只需移动到一个方向的最远请求为止

![29.png](https://i.loli.net/2021/06/17/jVrvYc4WySl7DkL.png)

#### 12.4.6 磁盘调度算法的选择

- SSTF较为常见

- 对于磁盘负荷较大的系统，SCAN和C-SCAN表现更好，因为它们不太可能造成饥饿

- 磁盘调度算法应该作为OS的一个单独模块，SSTF或LOOK是默认算法的合理选择

- 性能取决于
  - 文件分配方式(连续/分散)
  - 目录和索引块的位置(柱面间距离)

### 12.? 磁盘缓存

- 磁盘缓存是内存中磁盘扇区的缓冲区
  - 包含磁盘上某些扇区的副本

- 当针对特定扇区发出I / O请求时
  - 检查以确定该扇区是否在磁盘缓存中

- 存在许多填充缓存的方法

**单缓存**

![30.png](https://i.loli.net/2021/06/17/lH7W5G8QfBDYA6S.png)

![31.png](https://i.loli.net/2021/06/17/WNbDrgIvi3cPjKV.png)

### 12.5 磁盘管理

#### 12.5.1 磁盘格式化

**低级(low-level)格式化/物理(physical)格式化**

将磁盘划分为磁盘控制器可以读取和写入的扇区

---

在可以使用磁盘存储文件之前，OS仍需要将自己的数据结构记录在磁盘上

- 将磁盘分为由柱面组成的多个分区

- **逻辑格式化(logical formatting)**或创建文件系统

  将初始的文件系统数据结构存储到磁盘上

---

为了提高效率，大多数操作系统将块组合在一起变成更大的块，称为簇

- 磁盘I/O按块完成
- 文件I/O按簇完成

有效确保了I/O具有更多的顺序访问和更少的随机访问的特点

#### 12.5.2 引导块

- **自举(bootstrap)**程序处在**只读存储器(Read-Only Memory, ROM)**中

- 自居程序的作用是从磁盘上调入完整的引导程序
- **引导分区(boot partition)**：包含OS和设备驱动程序

- **(Master Boot Record)MBR**：引导代码存放在磁盘的第一个扇区

引导首先运行驻留在ROM中的代码，指示系统从**MBR**中读取引导代码。通过**MBR**中的分区表找到**引导分区**，读取分区的第一个扇区，称为**引导扇区**

![32.png](https://i.loli.net/2021/06/17/mAZopGb4t3XO8f6.png)

#### 12.5.3 坏块(Disk Failure)

**坏块解决策略**

1. 手动处理

   发现坏块标记为不可用

2. **扇区备用(sector sparing)**

   低级格式化将一些块放在一边作为备用，控制器可以采用备用块来逻辑地替代坏块(每次读取坏块转换成控制器的替代扇区地址)

3. **扇区滑动(sector slipping)**
   - 逻辑块17变坏
   - 第一个可用的备用块在202之后
   - 202→203, 201→202, ..., 17→18

### 12.6 交换空间管理

#### 交换空间

虚拟内存采用磁盘空间作为内存的扩展

- 交换空间可以位于普通文件系统之上
- 可以是一个单独的磁盘分区

### 12.7 RAID 结构

**磁盘冗余阵列(RAID)**：多个磁盘驱动器通过冗余提供可靠性，更高的数据传输率

#### 12.7.3 RAID级别

RAID共被分为六个级别

![33.png](https://i.loli.net/2021/06/17/1dWraZblq3geD7c.png)

##### RAID-0 磁盘分条(disk striping)

![34.png](https://i.loli.net/2021/06/17/BzgMy5LEmDCKrGR.png)

- 并行数据块访问提供更大的磁盘带宽

##### RAID-1 磁盘镜像

简单复制

![35.png](https://i.loli.net/2021/06/17/Kv9ulp3Jx2Ij56c.png)

- 可靠性指数倍增长

- 读取性能现性增长

##### RAID-4 块级分条(block-level striping) +  专用奇偶校验(parity)

![36.png](https://i.loli.net/2021/06/17/hesRWLO4SjXiGf7.png)

- 允许从任何发生故障的磁盘中恢复

##### RAID-5 磁盘分条 + 分布式奇偶校验

![37.png](https://i.loli.net/2021/06/17/g9WCEfKABReQmhT.png)

##### RAID 0 + 1	/ 1 + 0

<img src="https://i.loli.net/2021/06/17/G82i6rTUQqtljAD.png" alt="38.png"  />

### 作业

10.1 Is disk scheduling, other than FCFS scheduling, useful in a single-user
environment? Explain your answer.



10.2 Explain why SSTF scheduling tends to favor middle cylinders over the
innermost and outermost cylinders.



10.3 Why is rotational latency usually not considered in disk scheduling?
How would you modify SSTF, SCAN, and C-SCAN to include latency
optimization?



10.4 Why is it important to balance file-system I/O among the disks and
controllers on a system in a multitasking environment?



10.9 None of the disk-scheduling disciplines, except FCFS, is truly fair
(starvation may occur).
a. Explain why this assertion is true.
b. Describe a way to modify algorithms such as SCAN to ensure
fairness.
c. Explain why fairness is an important goal in a time-sharing
system.
d. Give three or more examples of circumstances in which it is
important that the operating system be unfair in serving I/O
requests.



10.11 Suppose that a disk drive has 5,000 cylinders, numbered 0 to 4,999. The drive is currently serving a request at cylinder 2,150, and the previous request was at cylinder 1,805. The queue of pending requests, in FIFO order, is: 2,069, 1,212, 2,296, 2,800, 544, 1,618, 356, 1,523, 4,965, 3681
Starting from the current head position, what is the total distance (in
cylinders) that the disk arm moves to satisfy all the pending requests
for each of the following disk-scheduling algorithms?
a. FCFS
b. SSTF
c. SCAN
d. LOOK
e. C-SCAN
f. C-LOOK