---
title: 第12章 数据库
date: 2021-4-12 24:00:00
tags: 
categories: C#&nbsp;
---
## 数据库

### 12.2 ADO.NET

<!-- more -->

System.Data名称空间

#### 12.2.1 ADO.NET的四个重要对象

![8.png](https://i.loli.net/2021/04/20/7wIoXtaiT4vBpUq.png)

### 12.3 访问数据库的方法

#### 12.3.1 方式一 DataAdapter及DataSet

- 适合于“离线”处理
- 自动建立Command对象

```c#
OleDbCommandBuilder cmdbld = new OleDbCommandBuilder(daAdapter);

// 数据集
DataSet dsMyData = new DataSet();

// 填充数据
daAdapter.Fill(dyMyData);

// 访问数据
foreach(DataTable table in dyMyData.Tables) {
    foreach(DataRow row in table.Rows) {
        foreach(object field in row.ItemArray) {
            Console.Write(field);
        }
        Console.WriteLine();
    }
}
Console.WriteLine(dyMyData.Table[0].Rows[0][1]);

// 提交数据的改变
daAdapter.Update(dyMyData);

// DataSet与XML转换
dyMyData.WriterXml("test.xml");
dyMyData.ReadXml("test.xml");
```

#### 12.3.2 DataReader

- 适合于只读数据，效率较高

```c#
OleDbDataReader MyReader = MyCommand.ExecuteReader();
while(MyReader.Read())
{
    Console.WriteLine(
    	MyReader.GetString(1) + 
        MyReader["Name"].ToString() +
        MyReader[2].ToString()
    );
}
```

#### 12.3.3 使用Command对象

- ExecuteReader ()
  - 得到 Reader 对象，单向只读
- ExecuteScalar ()
  - 得到单一的量，如 sum,avg 等的结果
- ExecuteNonQuery ()
  - 执行非查询性的命令（如 Update/Delete/Insert)
  - 返回的是它所影响的记录数

```c#
// 使用Command的ExecuteScalar
MyCommand.CommandText = "Select COUNT(*) From [Test]";
int cnt = (int) MyCommand.ExecuteScalar();

// 使用Command的ExecuteNonQuery
MyCommand.CommandText = "Delete From [Test] Where [Name] = 'T'";
int cntDeleted = MyCommand.ExecuteNonQuery();
```

#### 12.3.4 使用参数

```c#
cmd.CommandText = "INSERT INTO CName , EName , FName ) VALUES
(@CName , @EName , @FName);
cmd.Connection = this.sqlConnection1;
cmd.Parameters.Add(@CName ", SqlDbType.VarChar, 60).Value =
                   " aaaaaa ";
```