---
title: 第8章 绘图及图像
date: 2021-4-8 24:00:00
tags: 
categories: C#&nbsp;
---
## 绘图及图像

### 8.1 绘图基础GDI+

<!-- more -->

GDI：Graphics Device Interface（图形设备界面）

```c#
Graphics g = this.CreateGraphics();
Pen pen = new Pen(Color.Red, 2);
Brush brush = new SolidBrush(Color.Blue);
Font font = new Font("宋体", 25);
Rectangle rect = new Rectangle(20, 120, 100, 160);
g.DrawLine(pen, 20, 100, 100, 100);
g.DrawRectangle(pen, rect);
g.DrawString("GDI+图形编程", font, brush, 20, 20);
brush.Dispose(); font.Dispose(); pen.Dispose();
g.Dispose();
```

#### 8.1.1 坐标系统

(0, 0)	——>	(x, 0)

​	⬇

(0, y)

#### 8.1.2 System.Drawing中常用的结构

##### Color

**静态成员**

Color.Red

**静态方法**

- FromArab
- FromKnownColor
- FromName

##### Size和SizeF

##### Point

##### Rectangle

### 8.2 绘图对象及绘图方法

#### 8.2.1 得到Graphics对象

- OnPaint事件中

  ```c#
  Graphics g = e.Graphics;
  ```

- 在其他情况使用

  ```c#
  Graphics g = this.CreateGraphics();
  ```

#### 8.2.2 释放Graphics

- g.Dispose();

用这样也可以using(Graphics g = this.CreateGraphics()) { …. }

- 这种写法，相当于try{…….} finally{ g.Dispose(); }

#### 8.2.3Graphics对象绘图方法

<img src="https://i.loli.net/2021/04/20/Dvd5e8jXiASCMha.png" alt="1.png" style="zoom:80%;" />

- Graphics对象绘制实心图形方法

<img src="https://i.loli.net/2021/04/20/pK2ZiPY3r4FTEbC.png" alt="2.png" style="zoom:80%;" />

#### 8.2.4 Pen画笔

```c#
Pen pen= new Pen(Color.Blue,5);
```

#### 8.2.5 DrawString方法

```c#
DrawString(string,Font,Brush,RectangleF);
```

#### 8.2.6 Path

```c#
GraphicsPath gp = new ;
gp.AddString();
Brush brush = new;
e.Graphics.DrawPath(Pens.Black, gp);
e.Graphics.FillPath(brush, gp);
```

### 8.4 控件的重绘及双缓冲

#### 8.4.1 处理重绘和无效操作

当窗体被覆盖，前面的窗体移开后需要重绘

- 调用以下几个方法
  - void Invalidate();

  - void Invalidate( Rectangle ) ;

    使控件的特定区域无效并向控件发送绘制消息

  - void Update();

    使控件重绘其工作区内的无效区域

  - void Refresh();

    相当于this.Invalidate(true); this.Update();

#### 8.4.2 双缓冲技术

在内存中画好再显示在窗体上

1. 在内存中建立一块“虚拟画布”：

   Bitmap bmp = new Bitmap(600, 600);

2. 获取这块内存画布的Graphics引用：

   Graphics g = Graphics.FromImage(bmp);

3. 在这块内存画布上绘图：

   g.FillEllipse(brush, i* 10, j * 10, 10, 10);

   g.DrawLine() g.DrawString()等等

4. 将内存画布画到窗口中

   this.CreateGraphics().DrawImage(bmp, 0, 0);

**控件的DoubleBuffered属性**

在framework3以上版本中有

### 8.5 图像处理

#### 8.5.1 Bitmap类

可以处理BMP、Jpeg、GIF、PNG等格式

```c#
Bitmap bt1 = new Bitmap(“c:\\1.bmp”);
Bitmap bt2 = new Bitmap(bt1,200,300);
bt3.FromFile(“文件名称”);
```

#### 8.5.2 图像处理

**使用指针逐点处理**

反转、变灰、加亮……

```c#
// 需要设置unsafe
bitmapData = bitmap.LockBits(bounds, ImageLockMode.ReadWrite, PixelFormat.Format24bppRgb);
pBase = (Bypte*)bitmapData.Scan0.ToPointer();
(PixelData*)(pBase + y * stride + x * sizeof(PixelData));
```

